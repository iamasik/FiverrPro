var T_uibr;function addAnalyticsButton(){let e=document.getElementsByClassName("top-filters")[1];if(e){let t=new URLSearchParams(window.location.search).get("query");t&&e.insertAdjacentHTML("beforeend",'<a id="fvab" href="https://www.emlinter.com/fiverr-keyword-analytics/report?target=fiverr+button&keyword='+t+'" target="_blank" style="font-size: 16px; color: #fff; display: inline-block; background: linear-gradient(135deg, #ec4899 0%, #9d4edd 100%); border: none; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 2px 4px rgba(157, 78, 221, 0.3); "><img src="https://www.emlinter.com/images/logo.png" style=" position: relative; top: 4px; height: 20px; margin-right: 5px; ">Get Analytics</a>')}}function sendRankData(e,t){chrome.runtime.sendMessage({status:"completed",searchMode:"single",listings:e,page:t})}chrome.storage.sync.get(["hmbl"],function(e){!0==e.hmbl?document.head.insertAdjacentHTML("beforeend",'<style id="hmbl-tag">.user-balance,.grade{filter:blur(5px);color:transparent;text-shadow:0 0 8px rgba(0,0,0,0.5);}.user-balance:hover,.grade:hover{filter:none;color:initial;text-shadow:none;}</style>'):document.head.insertAdjacentHTML("beforeend",'<style id="hmbl-tag-no">.user-balance,.grade{filter:none;cursor:default}.user-balance:hover,.grade:hover{filter:blur(0)}</style>')}),chrome.storage.sync.get(["hop"],function(e){!0==e.hop?document.head.insertAdjacentHTML("beforeend",'<style id="hop-tag">.order-data li.price{filter:blur(5px);color:transparent;text-shadow:0 0 8px rgba(0,0,0,0.5);}.order-data li.price:hover{filter:none;color:initial;text-shadow:none;}</style>'):document.head.insertAdjacentHTML("beforeend",'<style id="hop-tag-no">.order-data li.price{filter:none;cursor:default}.order-data li.price:hover{filter:blur(0)}</style>')}),chrome.storage.sync.get(["fvdm"],function(e){!0==e.fvdm?document.documentElement.classList.add("darkmode-by-fivdata"):document.documentElement.classList.remove("darkmode-by-fivdata")});function addFixItButton(){let e=document.querySelector('button[data-testid="create-custom-offer-button"]')||document.querySelector('button:has-text("Create an Offer")')||Array.from(document.querySelectorAll('button')).find(b=>b.textContent&&b.textContent.trim()==="Create an Offer");if(e&&!document.getElementById("fiverr-plus-fixit-btn")){let t=e.closest("span")||e.parentElement;if(t&&t.parentElement){let a=document.createElement("span");a.className="_1y8bhjn14 _1y8bhjn1e _1y8bhjn1j a17q930";a.style.cssText="--_1y8bhjnf: fit-content; --_1y8bhjn5: 100%; --_1y8bhjn0: fit-content; display: flex; align-items: center; margin-right: 8px;";let n=document.createElement("button");n.id="fiverr-plus-fixit-btn";n.className="_1g8w6ydr piyede5 _1ql096fz _1g8w6ydw _1g8w6yds _1g8w6ydt _1g8w6ydu _1g8w6ydk a17q93rd a17q93uf a17q93zu a17q93qo a17q9325a a17q9325b a17q93d a17q9317c a17q93195 a17q9310e a17q930 a17q931ko a17q937 a17q93q a17q93278 a17q9327o a17q9327k a17q93a a17q9313b a17q93v a17q931f a17q931cm a17q931f4 a17q931bd";n.setAttribute("role","button");n.style.cssText="background: linear-gradient(135deg, #9d4edd 0%, #ec4899 100%); color: #fff; border: none; padding: 0 20px; height: 36px; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 2px 4px rgba(157, 78, 221, 0.3); display: flex; align-items: center; justify-content: center;";n.textContent="Fix It";n.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();handleFixItClick()});a.appendChild(n);t.parentElement.insertBefore(a,t)}}}function showErrorToast(e){let t=document.getElementById("fiverr-plus-error-toast");if(t){t.remove()}t=document.createElement("div");t.id="fiverr-plus-error-toast";t.style.cssText="position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:#fff;padding:16px 20px;border-radius:12px;box-shadow:0 4px 12px rgba(239,68,68,0.4);z-index:999999;max-width:400px;font-size:14px;font-weight:500;line-height:1.5;animation:slideInRight 0.3s ease;";t.textContent=e;document.body.appendChild(t);setTimeout(function(){t.style.animation="slideOutRight 0.3s ease";setTimeout(function(){t.remove()},300)},5000)}function handleFixItClick(){try{let e=document.getElementById("send-message-text-area");if(!e){showErrorToast("Text area not found. Please try again.");return}let t=e.value.trim();if(!t){showErrorToast("Please enter some text to refine.");return}try{chrome.storage.sync.get(["aiApiKey","aiModel"],function(a){if(chrome.runtime.lastError){showErrorToast("Unable to access settings. Please reload the page.");return}if(!a.aiApiKey||!a.aiApiKey.trim()){showErrorToast("API key not found. Please add your API key in the extension settings.");return}let n=document.getElementById("fiverr-plus-fixit-btn");if(n){n.textContent="Processing...";n.disabled=!0;n.style.opacity="0.7";n.style.cursor="not-allowed"}refineTextWithAI(t,a.aiApiKey,a.aiModel||"gemini",function(r){if(n){n.textContent="Fix It";n.disabled=!1;n.style.opacity="1";n.style.cursor="pointer"}if(r&&r.trim()){e.value=r;e.dispatchEvent(new Event("input",{bubbles:!0}));let o=e.scrollHeight;e.style.height=o+"px"}else{showErrorToast("No refined text received. Please try again.")}},function(o){if(n){n.textContent="Fix It";n.disabled=!1;n.style.opacity="1";n.style.cursor="pointer"}let r="An error occurred. Please try again.";if(o&&o.message){let i=o.message.toLowerCase();if(i.includes("quota")||i.includes("rate limit")||i.includes("429")){r="API quota exceeded. Please try again later or check your API usage limits."}else if(i.includes("overloaded")||i.includes("503")||i.includes("unavailable")){r="Service is temporarily overloaded. Please try again in a few moments."}else if(i.includes("invalid")||i.includes("401")||i.includes("403")){r="Invalid API key. Please check your API key in the extension settings."}else if(i.includes("network")||i.includes("fetch")){r="Network error. Please check your internet connection and try again."}}showErrorToast(r)})})}catch(e){if(e.message&&e.message.includes("Extension context invalidated")){showErrorToast("Extension was reloaded. Please refresh the page.")}else{showErrorToast("An unexpected error occurred. Please try again.")}}}catch(e){showErrorToast("An error occurred. Please try again.")}}function refineTextWithAI(e,t,a,n,o){try{let r="gemini-2.5-flash";let i="https://generativelanguage.googleapis.com/v1beta/models/"+r+":generateContent?key="+t;let s="Please refine the following text to be grammatically correct and professional, while maintaining the same meaning, tone, and approximate length. Do not add or remove any significant content. Only fix grammar, spelling, and improve clarity. Return only the refined text without any explanations or additional text:\n\n"+e;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:s}]}]})}).then(function(t){if(!t.ok){return t.text().then(function(a){let r="";try{let i=JSON.parse(a);if(i.error&&i.error.message){r=i.error.message;if(i.error.status){r="Status "+i.error.status+": "+r}}else{r="API request failed: "+t.status}}catch(e){r="API request failed: "+t.status}throw new Error(r)})}return t.json()}).then(function(t){if(t.candidates&&t.candidates.length>0){let a=t.candidates[0];if(a.content&&a.content.parts&&a.content.parts.length>0){let r=a.content.parts[0].text;if(r&&r.trim()){n(r.trim());return}}if(a.text){n(a.text.trim());return}}if(t.text){n(t.text.trim());return}throw new Error("Invalid API response format - no text found")}).catch(function(t){o(t)})}catch(e){o(e)}}function removeFixItButton(){let e=document.getElementById("fiverr-plus-fixit-btn");e&&e.closest("span")&&e.closest("span").remove()}function checkAndToggleFixItButton(){try{let e=window.location.href;if(!e.match(/https:\/\/www\.fiverr\.com\/inbox\/.+/)){removeFixItButton();return}let t=document.querySelector('button[data-testid="create-custom-offer-button"]')||Array.from(document.querySelectorAll('button')).find(b=>b.textContent&&b.textContent.trim()==="Create an Offer");if(!t){setTimeout(checkAndToggleFixItButton,500);return}chrome.storage.sync.get(["aiAssistEnabled","aiApiKey"],function(a){try{if(chrome.runtime.lastError){if(chrome.runtime.lastError.message&&chrome.runtime.lastError.message.includes("Extension context invalidated")){return}return}if(a.aiAssistEnabled&&a.aiApiKey&&a.aiApiKey.trim()!==""){addFixItButton();setTimeout(checkAndToggleFixItButton,1000)}else{removeFixItButton()}}catch(e){if(e.message&&!e.message.includes("Extension context invalidated")){removeFixItButton()}}})}catch(e){if(e.message&&!e.message.includes("Extension context invalidated")){setTimeout(checkAndToggleFixItButton,1000)}}chrome.storage.onChanged.addListener(function(e,t){try{for(var a in e){var r=e[a];if("hmbl"==a){if(r.newValue){document.head.insertAdjacentHTML("beforeend",'<style id="hmbl-tag">.user-balance,.grade{filter:blur(5px);color:transparent;text-shadow:0 0 8px rgba(0,0,0,0.5);}.user-balance:hover,.grade:hover{filter:none;color:initial;text-shadow:none;}</style>');document.getElementById("hmbl-tag-no").remove()}else{document.head.insertAdjacentHTML("beforeend",'<style id="hmbl-tag-no">.user-balance,.grade{filter:none;cursor:default}.user-balance:hover,.grade:hover{filter:blur(0)}</style>');document.getElementById("hmbl-tag").remove()}}if("hop"==a){if(r.newValue){document.head.insertAdjacentHTML("beforeend",'<style id="hop-tag">.order-data li.price{filter:blur(5px);color:transparent;text-shadow:0 0 8px rgba(0,0,0,0.5);}.order-data li.price:hover{filter:none;color:initial;text-shadow:none;}</style>');document.getElementById("hop-tag-no").remove()}else{document.head.insertAdjacentHTML("beforeend",'<style id="hop-tag-no">.order-data li.price{filter:none;cursor:default}.order-data li.price:hover{filter:blur(0)}</style>');document.getElementById("hop-tag").remove()}}if("fvui"==a){if(r.newValue)addAnalyticsButton();else{let o=document.getElementById("fvab");o&&o.remove(),document.querySelectorAll(".uibr").forEach(e=>e.remove()),clearInterval(T_uibr)}}if("fvdm"==a){r.newValue?document.documentElement.classList.add("darkmode-by-fivdata"):document.documentElement.classList.remove("darkmode-by-fivdata")}if("aiAssistEnabled"==a||"aiApiKey"==a){let e=window.location.href;if(e.match(/https:\/\/www\.fiverr\.com\/inbox\/.+/))checkAndToggleFixItButton()}}}catch(e){}}),console.log("Fiverr Pro -> Extension Activated"),document.addEventListener("DOMContentLoaded",function(){chrome.storage.sync.get(["fvui"],function(e){!0==e.fvui&&addAnalyticsButton()});let e=window.location.href;if(e.match(/https:\/\/www\.fiverr\.com\/inbox\/.+/)){checkAndToggleFixItButton(),setInterval(function(){let t=window.location.href;if(t.match(/https:\/\/www\.fiverr\.com\/inbox\/.+/))checkAndToggleFixItButton()},2000)}});let lastUrl=location.href;new MutationObserver(()=>{const e=location.href;if(e!==lastUrl){lastUrl=e;let t=window.location.href;if(t.match(/https:\/\/www\.fiverr\.com\/inbox\/.+/))checkAndToggleFixItButton()}}).observe(document,{subtree:!0,childList:!0});